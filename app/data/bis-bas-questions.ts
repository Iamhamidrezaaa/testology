import { Question } from '@/types/test'
import { normalizeQuestions } from '@/lib/helpers/question-helper'

// فقط فیلدهای خام هر سؤال
type RawQuestion = Pick<Question, 'text' | 'options'>


const rawQuestions: RawQuestion[] = [
  {
    text: "من از تجربه‌های جدید لذت می‌برم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من اغلب نگران اشتباه کردن هستم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من دوست دارم در مرکز توجه باشم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از موقعیت‌های خطرناک اجتناب می‌کنم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از موفقیت لذت می‌برم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من اغلب احساس گناه می‌کنم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من دوست دارم با افراد جدید آشنا شوم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از تنبیه می‌ترسم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از پاداش لذت می‌برم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من اغلب احساس اضطراب می‌کنم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از رقابت لذت می‌برم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از انتقاد می‌ترسم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از تحسین لذت می‌برم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من اغلب احساس نگرانی می‌کنم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از چالش‌ها لذت می‌برم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از شکست می‌ترسم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از پیشرفت لذت می‌برم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من اغلب احساس استرس می‌کنم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از ماجراجویی لذت می‌برم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از اشتباه کردن می‌ترسم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از موفقیت‌هایم لذت می‌برم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من اغلب احساس ناراحتی می‌کنم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از فرصت‌های جدید لذت می‌برم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  },
  {
    text: "من از تنبیه شدن می‌ترسم",
    options: [
      "کاملاً مخالفم",
      "مخالفم",
      "نظری ندارم",
      "موافقم",
      "کاملاً موافقم"
    ]
  }
]



// خروجی نهایی با فیلدهای اجباری تکمیل می‌شود
export const bisBasQuestions: Question[] = normalizeQuestions(rawQuestions, {
  testId: 'bis-bas',
  type: 'SINGLE_CHOICE',
  required: true
})

export const bisBasOptions = [
  { label: "کاملاً مخالفم", value: "1" },
  { label: "مخالفم", value: "2" },
  { label: "نظری ندارم", value: "3" },
  { label: "موافقم", value: "4" },
  { label: "کاملاً موافقم", value: "5" }
]

export const getBisBasInterpretation = (scores: { [key: string]: number }): string => {
  const interpretations: { [key: string]: { [key: string]: string } } = {
    "BIS": {
      "low": "شما فردی آرام و مقاوم در برابر استرس هستید که کمتر نگران پیامدهای منفی هستید.",
      "medium": "شما تعادل مناسبی بین احتیاط و جسارت دارید.",
      "high": "شما فردی محتاط و حساس هستید که به پیامدهای منفی توجه زیادی می‌کنید."
    },
    "BAS": {
      "low": "شما فردی محتاط و کم‌انرژی هستید که کمتر به دنبال پاداش و لذت هستید.",
      "medium": "شما تعادل مناسبی بین انگیزه و احتیاط دارید.",
      "high": "شما فردی پرانرژی و انگیزه‌مند هستید که به دنبال پاداش و لذت هستید."
    }
  }

  let result = "نتایج تست BIS-BAS شما:\n\n"
  
  Object.keys(scores).forEach(factor => {
    const score = scores[factor]
    let level = "medium"
    if (score <= 2) level = "low"
    else if (score >= 4) level = "high"
    
    result += `${factor}: ${interpretations[factor][level]}\n\n`
  })
  
  return result
}

export const calculateBisBasScores = (answers: string[]): { [key: string]: number } => {
  const scores = {
    "BIS": 0, // Behavioral Inhibition System
    "BAS": 0  // Behavioral Activation System
  }
  
  // محاسبه امتیازات بر اساس پاسخ‌ها
  answers.forEach((answer, index) => {
    const score = parseInt(answer)
    
    // سوالات مربوط به BIS (ترس و اضطراب)
    if (index === 1 || index === 3 || index === 5 || index === 7 || index === 9 || 
        index === 11 || index === 13 || index === 15 || index === 17 || index === 19 || 
        index === 21 || index === 23) {
      scores["BIS"] += score
    } else {
      // سوالات مربوط به BAS (انگیزه و پاداش)
      scores["BAS"] += score
    }
  })
  
  // محاسبه میانگین
  scores["BIS"] = scores["BIS"] / 12
  scores["BAS"] = scores["BAS"] / 12
  
  return scores
}

export default bisBasQuestions


