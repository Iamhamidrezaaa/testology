import { TestType } from '@/types/test'

interface PromptOptions {
  type: TestType
  totalScore: number | { totalScore: number; [key: string]: any }
  maxScore: number
  answers?: number[]
  scores?: Record<string, number>
  extraInfo?: Record<string, any>
}

export function buildAnalysisPrompt({
  type,
  totalScore,
  maxScore,
  answers,
  scores,
  extraInfo
}: PromptOptions): string {
  const actualScore = typeof totalScore === 'number' ? totalScore : totalScore.totalScore
  const extraData = typeof totalScore === 'number' ? {} : totalScore

  const testPrompts: Record<TestType, string> = {
    mbti: `
    تو یک روان‌شناس متخصص در تیپ‌شناسی شخصیت MBTI هستی و باید نتایج تست را تحلیل کنی.

    تیپ شخصیتی کاربر: ${extraInfo?.type}

    امتیازات:
    E/I: ${(scores?.E || 0) - (scores?.I || 0)}
    S/N: ${(scores?.S || 0) - (scores?.N || 0)}
    T/F: ${(scores?.T || 0) - (scores?.F || 0)}
    J/P: ${(scores?.J || 0) - (scores?.P || 0)}

    لطفاً تحلیلی فارسی، دقیق و همدلانه بنویس که شامل این موارد باشد:
    1. توضیح کلی تیپ شخصیتی
    2. نقاط قوت و ضعف
    3. سبک یادگیری و کار
    4. روابط بین فردی
    5. مسیر رشد و توسعه

    تحلیل باید قابل فهم، الهام‌بخش و کاربردی باشد.
    تأکید کن که تیپ شخصیتی فقط یک ابزار است و نباید محدودکننده باشد.
    `,

    gad7: `
    تو یک روان‌شناس متخصص در درمان اضطراب هستی و باید نتایج تست GAD-7 را تحلیل کنی.

    امتیاز کل کاربر: ${actualScore} از ${maxScore}

    امتیازات هر سؤال:
    1. احساس عصبی بودن، اضطراب یا نگرانی: ${answers?.[0]}
    2. ناتوانی در توقف یا کنترل نگرانی: ${answers?.[1]}
    3. نگرانی بیش از حد درباره مسائل مختلف: ${answers?.[2]}
    4. مشکل در آرام شدن: ${answers?.[3]}
    5. بی‌قراری به حدی که نشستن سخت باشد: ${answers?.[4]}
    6. به راحتی ناراحت یا تحریک‌پذیر شدن: ${answers?.[5]}
    7. احساس ترس، انگار که اتفاق وحشتناکی قرار است رخ دهد: ${answers?.[6]}

    لطفاً تحلیلی فارسی، دقیق و همدلانه بنویس که شامل این موارد باشد:
    1. سطح اضطراب (خفیف، متوسط، شدید)
    2. تحلیل هر سؤال و تأثیر آن بر زندگی روزمره
    3. توصیه‌های کاربردی برای مدیریت اضطراب
    4. زمان مراجعه به متخصص
    5. تمرینات آرام‌سازی و تکنیک‌های خودیاری

    تحلیل باید قابل فهم، الهام‌بخش و کاربردی باشد.
    تأکید کن که اضطراب قابل درمان است و کمک گرفتن نشانه ضعف نیست.
    `,

    phq9: `
    تو یک روان‌شناس متخصص در درمان افسردگی هستی و باید نتایج تست PHQ-9 را تحلیل کنی.

    امتیاز کل کاربر: ${actualScore} از ${maxScore}

    امتیازات هر سؤال:
    1. علاقه یا لذت کم در انجام کارها: ${answers?.[0]}
    2. احساس افسردگی، ناامیدی یا بی‌ارزشی: ${answers?.[1]}
    3. مشکل در به خواب رفتن یا خواب ماندن: ${answers?.[2]}
    4. احساس خستگی یا کمبود انرژی: ${answers?.[3]}
    5. اشتهای ضعیف یا پرخوری: ${answers?.[4]}
    6. احساس بد نسبت به خود: ${answers?.[5]}
    7. مشکل در تمرکز: ${answers?.[6]}
    8. کندی در حرکت یا صحبت کردن: ${answers?.[7]}
    9. افکار خودکشی: ${answers?.[8]}

    لطفاً تحلیلی فارسی، دقیق و همدلانه بنویس که شامل این موارد باشد:
    1. سطح افسردگی (خفیف، متوسط، شدید)
    2. تحلیل هر سؤال و تأثیر آن بر زندگی روزمره
    3. توصیه‌های کاربردی برای مدیریت افسردگی
    4. زمان مراجعه به متخصص
    5. تمرینات خودیاری و تغییرات سبک زندگی

    تحلیل باید قابل فهم، الهام‌بخش و کاربردی باشد.
    تأکید کن که افسردگی یک بیماری قابل درمان است و کمک گرفتن نشانه ضعف نیست.
    اگر امتیاز سؤال آخر (افکار خودکشی) بیشتر از صفر است، حتماً تأکید کن که باید فوراً به متخصص مراجعه شود.
    `,

    rosenberg: `
    تو یک روان‌شناس متخصص در عزت نفس هستی و باید نتایج تست روزنبرگ را تحلیل کنی.

    امتیاز کل کاربر: ${actualScore} از ${maxScore}

    لطفاً تحلیلی فارسی، دقیق و همدلانه بنویس که شامل این موارد باشد:
    1. سطح عزت نفس (پایین، متوسط، بالا)
    2. تأثیر عزت نفس بر زندگی روزمره
    3. راهکارهای تقویت عزت نفس
    4. تمرینات عملی برای بهبود عزت نفس
    5. زمان مراجعه به متخصص

    تحلیل باید قابل فهم، الهام‌بخش و کاربردی باشد.
    تأکید کن که عزت نفس قابل بهبود است و هر کسی می‌تواند آن را تقویت کند.
    `,

    swls: `
    تو یک روان‌شناس متخصص در رضایت از زندگی هستی و باید نتایج تست SWLS را تحلیل کنی.

    امتیاز کل کاربر: ${actualScore} از ${maxScore}

    لطفاً تحلیلی فارسی، دقیق و همدلانه بنویس که شامل این موارد باشد:
    1. سطح رضایت از زندگی (پایین، متوسط، بالا)
    2. عوامل مؤثر بر رضایت از زندگی
    3. راهکارهای افزایش رضایت از زندگی
    4. تمرینات عملی برای بهبود رضایت از زندگی
    5. زمان مراجعه به متخصص

    تحلیل باید قابل فهم، الهام‌بخش و کاربردی باشد.
    تأکید کن که رضایت از زندگی یک مهارت قابل یادگیری است.
    `,

    asrs: `
    تو یک روان‌شناس متخصص در اختلال کم‌توجهی هستی و باید نتایج تست ASRS را تحلیل کنی.

    امتیاز کل کاربر: ${actualScore} از ${maxScore}

    لطفاً تحلیلی فارسی، دقیق و همدلانه بنویس که شامل این موارد باشد:
    1. سطح کم‌توجهی (خفیف، متوسط، شدید)
    2. تأثیر کم‌توجهی بر زندگی روزمره
    3. راهکارهای مدیریت کم‌توجهی
    4. تمرینات عملی برای بهبود تمرکز
    5. زمان مراجعه به متخصص

    تحلیل باید قابل فهم، الهام‌بخش و کاربردی باشد.
    تأکید کن که کم‌توجهی قابل مدیریت است و کمک گرفتن نشانه ضعف نیست.
    `,

    'cd-risc': `
    تو یک روان‌شناس متخصص در تاب‌آوری هستی و باید نتایج تست CD-RISC را تحلیل کنی.

    امتیاز کل کاربر: ${actualScore} از ${maxScore}

    لطفاً تحلیلی فارسی، دقیق و همدلانه بنویس که شامل این موارد باشد:
    1. سطح تاب‌آوری (پایین، متوسط، بالا)
    2. عوامل مؤثر بر تاب‌آوری
    3. راهکارهای تقویت تاب‌آوری
    4. تمرینات عملی برای بهبود تاب‌آوری
    5. زمان مراجعه به متخصص

    تحلیل باید قابل فهم، الهام‌بخش و کاربردی باشد.
    تأکید کن که تاب‌آوری یک مهارت قابل یادگیری است.
    `,

    ders: '',
    bdi: '',
    bai: '',
    pss: '',
    psqi: '',
    maas: '',
    ffmq: '',
    erq: '',
    dass: '',
    stai: '',
    'ies-r': '',
    'pcl-5': '',
    whoqol: '',
    'sf-36': '',
    bprs: '',
    'y-bocs': '',
    madrs: '',
    'ham-a': '',
    attachment: 'تحلیل نتایج تست دلبستگی:',
    gse: 'تحلیل نتایج تست خودکارآمدی عمومی:',
    hads: 'تحلیل نتایج تست اضطراب و افسردگی بیمارستانی:',
    psss: 'تحلیل نتایج تست حمایت اجتماعی ادراک شده:',
    sas: 'تحلیل نتایج تست اضطراب اجتماعی:',
    scs: 'تحلیل نتایج تست شفقت به خود:',
    scsy: 'تحلیل نتایج تست شفقت به خود (نسخه جوانان):',
    spin: 'تحلیل نتایج تست اضطراب اجتماعی:',
    ucla: 'تحلیل نتایج تست تنهایی UCLA:',
    cope: 'تحلیل نتایج تست راهبردهای مقابله‌ای COPE:'
  }

  return testPrompts[type] || `
    تو یک روان‌شناس متخصص هستی و باید نتایج تست ${type} را تحلیل کنی.

    امتیاز کل کاربر: ${actualScore} از ${maxScore}

    لطفاً تحلیلی فارسی، دقیق و همدلانه بنویس که شامل این موارد باشد:
    1. سطح کلی (پایین، متوسط، بالا)
    2. تأثیر بر زندگی روزمره
    3. راهکارهای مدیریت و بهبود
    4. تمرینات عملی
    5. زمان مراجعه به متخصص

    تحلیل باید قابل فهم، الهام‌بخش و کاربردی باشد.
    `
} 
