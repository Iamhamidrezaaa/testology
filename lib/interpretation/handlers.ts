/**
 * Interpretation Handlers برای هر تست
 * این فایل شامل handlerهای اختصاصی برای تفسیر هر تست است
 */

import type {
  InterpretationChunk,
  TestInterpretationHandler,
} from "@/types/interpretation";
import type { ScoredResult } from "@/lib/scoring-engine-v2";
import {
  MBTI_RECOMMENDATIONS,
  RIASEC_RECOMMENDATIONS,
  ATTACHMENT_RECOMMENDATIONS,
  LEARNING_STYLE_RECOMMENDATIONS,
} from "./recommendations";

function chunk(
  id: string,
  body: string,
  title?: string,
  priority: "normal" | "high" = "normal",
  kind: "analysis" | "recommendation" = "analysis"
): InterpretationChunk {
  return { id, body, title, priority, kind };
}

/**
 * GAD-7 – اضطراب فراگیر
 */
const handleGAD7: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "minimal") {
    return [
      chunk(
        "gad7_minimal",
        "در پاسخ‌هایی که دادی، الگوی مشخصی از اضطراب پایدار دیده نمی‌شود. " +
          "طبیعتاً هر کسی گاهی نگران و مضطرب می‌شود، اما فعلاً چیزی شبیه یک اضطراب مزمن یا فرساینده دیده نمی‌شود. " +
          "اگر در موقعیت‌های خاص (مثلاً کار، رابطه یا شرایط مالی) احساس فشار می‌کنی، می‌توانی روی همان حوزه‌ها با تست‌های دقیق‌تر تمرکز کنی.",
        "نشانه‌های اضطراب"
      ),
    ];
  }

  if (level === "mild") {
    return [
      chunk(
        "gad7_mild",
        "جواب‌هایت نشان می‌دهد که در زندگی روزمره‌ات مقداری اضطراب همراهت هست؛ نه آن‌قدر شدید که همه‌چیز را مختل کند، " +
          "اما آن‌قدر محسوس که روی تمرکز، خواب یا احساس آرامش اثر بگذارد. " +
          "معمولاً این سطح از اضطراب با تغییرات کوچک در سبک زندگی، تنظیم خواب، و یادگرفتن چند مهارت ساده‌ی مدیریت استرس، قابل کنترل و بهبود است.",
        "اضطراب خفیف"
      ),
    ];
  }

  if (level === "moderate") {
    return [
      chunk(
        "gad7_moderate",
        "در این تست، نشانه‌های اضطراب در حدی دیده می‌شود که می‌تواند روی کیفیت روزهایت اثر جدی بگذارد؛ " +
          "مثلاً بیشتر درگیر نگرانی، تنش بدنی، دل‌مشغولی ذهنی یا سختی در آرام‌گرفتن باشی. " +
          "این سطح از اضطراب معمولاً از حالت «فقط استرس روزمره» عبور کرده و بهتر است جدی به آن توجه شود؛ " +
          "هم از طریق تغییرات سبک زندگی و هم در صورت امکان مشاوره‌ی حرفه‌ای.",
        "اضطراب در سطح قابل توجه"
      ),
    ];
  }

  if (level === "severe") {
    return [
      chunk(
        "gad7_severe",
        "پاسخ‌هایت نشان می‌دهد که اضطراب برایت به یک همراه جدی و فرساینده تبدیل شده؛ چیزی فراتر از استرس معمولیِ زندگی روزمره. " +
          "این سطح از اضطراب می‌تواند روی خواب، تمرکز، روابط و حتی تصمیم‌گیری‌ها اثر بگذارد. " +
          "پیشنهاد می‌شود در کنار مراقبت از سبک زندگی (خواب، تغذیه، فعالیت بدنی)، اگر امکانش را داری با یک متخصص سلامت روان هم صحبت کنی تا این فشار مدت طولانی روی دوشت نماند.",
        "اضطراب بالا و فرساینده",
        "high"
      ),
    ];
  }

  return [];
};

/**
 * PHQ-9 – افسردگی
 */
const handlePHQ9: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "minimal") {
    return [
      chunk(
        "phq9_minimal",
        "در پاسخ‌هایت الگوی واضحی از افسردگی پایدار دیده نمی‌شود. " +
          "افت خلق و خستگی گاهی جزئی از زندگی است، اما در حال حاضر چیزی شبیه یک دوره‌ی افسردگی گسترده دیده نمی‌شود. " +
          "اگر با این حال احساس می‌کنی در بعضی زمینه‌ها مثل انگیزه یا لذت‌بردن از کارهای روزمره مشکل داری، می‌توانی با تست‌های تکمیلی روی همان بخش‌ها دقیق‌تر شوی.",
        "خلق و انرژی"
      ),
    ];
  }

  if (level === "mild") {
    return [
      chunk(
        "phq9_mild",
        "جواب‌هایت نشان می‌دهد که در حال حاضر مقداری افت خلق، خستگی یا کاهش انگیزه را تجربه می‌کنی. " +
          "این سطح معمولاً با کمی توجه بیشتر به خواب، فعالیت بدنی، ارتباط اجتماعی و روتین روزانه قابل مدیریت است؛ " +
          "اما اگر این وضعیت طولانی شده یا رو به بدترشدن است، خوب است جدی‌تر به آن نگاه کنی.",
        "نشانه‌های ملایم از افت خلق"
      ),
    ];
  }

  if (level === "moderate") {
    return [
      chunk(
        "phq9_moderate",
        "الگوی پاسخ‌ها نشان می‌دهد که چند محور مهم مثل خلق، انرژی، لذت‌بردن از کارها و شاید خواب تحت فشار قرار گرفته‌اند. " +
          "این سطح از نشانه‌ها می‌تواند روی کار، روابط و کیفیت روزمره‌ی زندگی اثر بگذارد. " +
          "معمولاً ترکیبی از تنظیم سبک زندگی، حمایت اجتماعی و در صورت امکان مشاوره‌ی حرفه‌ای می‌تواند کمک بزرگی باشد.",
        "افسردگی در سطح متوسط"
      ),
    ];
  }

  if (level === "moderately_severe" || level === "severe") {
    return [
      chunk(
        "phq9_high",
        "در این تست نشانه‌هایی دیده می‌شود که با یک دوره‌ی نسبتاً جدی از افسردگی هم‌خوانی دارند؛ " +
          "چیزی فراتر از خستگی معمول یا دلسردی‌های کوتاه‌مدت. " +
          "اگر احساس می‌کنی انگیزه، امید یا لذت‌بردن از چیزهایی که قبلاً دوست داشتی کم شده، تنها نیستی و این وضعیت قابل فهم و قابل کمک است. " +
          "صحبت‌کردن با یک متخصص در کنار توجه به خواب، تغذیه، ارتباطات و فعالیت بدنی می‌تواند قدم مهمی برای سبک‌ترشدن این فشار باشد.",
        "نشانه‌های قابل توجه افسردگی",
        "high"
      ),
    ];
  }

  return [];
};

/**
 * PSS – استرس ادراک‌شده
 */
const handlePSS: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "pss_low",
        "در حال حاضر، استرس ادراک‌شده‌ات در محدوده‌ای است که اغلب با «فشار معمول زندگی» هم‌خوانی دارد. " +
          "هیچ‌کدام از ما کاملاً بدون استرس نیستیم، اما پاسخ‌هایت نشان می‌دهد که فعلاً احساس نمی‌کنی زیر موج بلند و مداوم فشار باشی.",
        "سطح استرس ادراک‌شده"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "pss_medium",
        "جواب‌هایت نشان می‌دهد که بخش قابل‌توجهی از انرژی ذهنی‌ات صرف مدیریت فشارها و نگرانی‌های روزمره می‌شود. " +
          "این سطح از استرس «غیرمعمول» نیست، اما اگر مدت طولانی ادامه پیدا کند، می‌تواند روی خواب، خلق، تمرکز و بدن اثر بگذارد. " +
          "یادگیری چند مهارت ساده‌ی مدیریت استرس و بازطراحی سبک زندگی می‌تواند کمک بزرگی باشد.",
        "استرس در سطح قابل توجه"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "pss_high",
        "در این تست، استرس ادراک‌شده‌ات در سطح بالایی قرار گرفته؛ یعنی ذهن و بدن تو احتمالاً مدت زیادی است در وضعیت آماده‌باش بوده‌اند. " +
          "این می‌تواند توضیحی برای خستگی مزمن، اختلال خواب، تحریک‌پذیری یا کاهش تمرکز باشد. " +
          "خوب است که در کنار تست‌های دیگر، به شکل جدی به استراحت واقعی، مرزگذاری در کار و روابط و اگر امکانش را داری گفت‌وگو با یک متخصص فکر کنی.",
        "استرس بالا و فرساینده",
        "high"
      ),
    ];
  }

  return [];
};

/**
 * LifestyleSleep – سبک خواب و استراحت
 */
const handleLifestyleSleep: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "sleep_low",
        "پاسخ‌هایت نشان می‌دهد که خواب در زندگی‌ات یکی از نقاط حساس است؛ چه از نظر مدت، چه از نظر عمق و چه از نظر خواب‌آلودگی روزانه. " +
          "چنین الگویی می‌تواند به خستگی مزمن، نوسان خلق و کاهش تمرکز منجر شود. اگر در تست‌های دیگر هم استرس یا اضطراب بالا باشد، احتمالاً این دو موضوع به هم گره خورده‌اند.",
        "کیفیت خواب پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "sleep_medium",
        "الگوی خواب تو نه کاملاً مشکل‌ساز است و نه کاملاً پایدار. به‌نظر می‌رسد گاهی خواب باکیفیتی داری و گاهی دچار دیرخوابیدن، بیداری‌های وسط شب یا خواب‌آلودگی روزانه می‌شوی. " +
          "با چند تغییر کوچک در روتین شبانه، زمان‌بندی و مدیریت نور/صفحه‌نمایش می‌شود این وضعیت را بهتر کرد.",
        "الگوی خواب نوسانی"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "sleep_high",
        "پاسخ‌هایت نشان می‌دهد که به‌طور کلی بدنت از نظر خواب، فرصت ریکاوری معقولی دارد. " +
          "اگر در تست‌های دیگر مثل استرس، اضطراب یا خلق فشاری دیده شود، همین خواب نسبتاً پایدار می‌تواند یک نقطه‌ی قوت مهم برای شروع تغییرات دیگر باشد.",
        "خواب نسبتاً پایدار"
      ),
    ];
  }

  return [];
};

/**
 * LifestyleHarmony – سبک زندگی کلی
 */
const handleLifestyleHarmony: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "lifestyle_low",
        "این تست نشان می‌دهد که چند محور اصلی زندگی‌ات – مثل خواب، استرس، انرژی روزانه، تعادل کار و زندگی و روتین‌ها – هم‌زمان تحت فشار هستند. " +
          "این یعنی احتمالاً احساس می‌کنی مدام در حال «دویدن» هستی، بدون این‌که واقعاً فرصت نفس‌کشیدن و ریکاوری داشته باشی. " +
          "این وضعیت تقصیر تو نیست؛ بیشتر نتیجه‌ی چیدمان شرایط و نقش‌هایی است که بر عهده داری. اما می‌توان قدم‌به‌قدم چیدمان را طوری تغییر داد که بدنت، ذهنت و رابطه‌هایت فرصت بیشتری برای نفس کشیدن پیدا کنند.",
        "سبک زندگی فرسایشی",
        "high"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "lifestyle_medium",
        "الگوی پاسخ‌ها نشان می‌دهد که سبک زندگی‌ات ترکیبی از عادت‌های خوب و عامل‌های فرساینده است. " +
          "بعضی چیزها در مسیر درستی جلو می‌روند و بعضی بخش‌ها (مثل خواب، استرس، تعادل کار–زندگی یا ریکاوری) نیاز به توجه بیشتری دارند. " +
          "این سطح، بهترین زمان برای پیشگیری است؛ یعنی قبل از این‌که بدن و ذهنت وارد چرخه‌ی خستگی مزمن شوند.",
        "سبک زندگی در مرز فشار"
      ),
    ];
  }

  if (level === "high" || level === "very_high") {
    return [
      chunk(
        "lifestyle_high",
        "به‌طور کلی، سبک زندگی‌ات تصویر یک تعادل نسبی تا خوب را نشان می‌دهد؛ نه بی‌نقص و نه فاجعه، " +
          "اما به‌قدری متعادل که بتواند زیرساخت خوبی برای رشد شخصی، کار و روابطت باشد. " +
          "اگر در تست‌های دیگر (مثل اضطراب، افسردگی یا استرس) فشاری دیده شود، همین تعادل نسبی در سبک زندگی می‌تواند نقطه‌ی تکیه‌ی مهمی برای تغییرات بعدی باشد.",
        "سبک زندگی نسبتاً هماهنگ"
      ),
    ];
  }

  return [];
};

/**
 * WorkLifeBalance – تعادل کار و زندگی
 */
const handleWorkLifeBalance: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "wlb_low",
        "پاسخ‌هایت نشان می‌دهد که مرز بین کار و زندگی شخصی‌ات تا حد زیادی محو شده. " +
          "این به این معنی نیست که لزوماً شغل یا خانواده‌ات را دوست نداری؛ بیشتر شبیه وضعیتی است که در آن کار، پیام‌ها، مسئولیت‌ها و فکرها تا آخر شب دنبالت می‌آیند و جایی برای خاموش‌شدن واقعی باقی نمی‌گذارند.",
        "تعادل کار و زندگی"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "wlb_medium",
        "نمره‌ی تو نشان می‌دهد گاهی تعادل خوبی بین کار و زندگی داری و گاهی یکی از این دو، تمام فضای روانی‌ات را اشغال می‌کند. " +
          "این وضعیت معمولاً با بازطراحی زمان‌بندی، نه‌گفتن‌های کوچک و تعریف‌کردن چند مرز نرم قابل‌بهبود است.",
        "تعادل نوسانی"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "wlb_high",
        "الگوی پاسخ‌ها نشان می‌دهد که تا حد زیادی توانسته‌ای بین کار، زندگی شخصی و استراحت واقعی مرز بگذاری. " +
          "اگر در تست‌های دیگر استرس، اضطراب یا خستگی بالا دیده شود، احتمالاً منبع فشار بیشتر از خود حجم کار و نقش‌ها می‌آید تا از مرزهای شخصی.",
        "تعادل نسبتاً خوب بین کار و زندگی"
      ),
    ];
  }

  return [];
};

/**
 * ISI – بی‌خوابی
 */
const handleISI: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "isi_low",
        "نمره‌ی پایین در این تست نشان می‌دهد مشکل خواب از نوع بی‌خوابی (سخت به خواب رفتن، بیدارشدن مکرر، بیدارشدن زودهنگام) در حال حاضر چندان پررنگ نیست.",
        "بی‌خوابی"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "isi_medium",
        "نمره‌ی متوسط یعنی بی‌خوابی گاهی مهمان شب‌های تو می‌شود؛ نه آن‌قدر که همه‌چیز را به‌هم بریزد، " +
          "اما آن‌قدر که خستگی و تمرکزت را تحت‌تأثیر قرار دهد. توجه به روتین خواب و عوامل استرس‌زا می‌تواند کمک کند.",
        "بی‌خوابی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "isi_high",
        "نمره‌ی بالا یعنی خواب یکی از محورهای اصلی فشار است؛ سخت به خواب می‌روی، زیاد بیدار می‌شوی یا صبح احساس سرحال بودن نمی‌کنی. " +
          "این وضعیت هم روی بدن، هم روی خلق و هم روی کارکرد روزانه اثر می‌گذارد و شایسته‌ی توجه جدی است.",
        "بی‌خوابی قابل توجه",
        "high"
      ),
    ];
  }

  return [];
};

/**
 * PSQI – کیفیت خواب
 */
const handlePSQI: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "psqi_good",
        "کیفیت کلی خواب در این تست در محدوده‌ی مطلوب است؛ " +
          "از نظر مدت، تأخیر در به خواب رفتن و بیدارشدن‌های شبانه، تصویر نسبتاً سالمی داریم.",
        "کیفیت خواب خوب"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "psqi_medium",
        "نمره‌ی متوسط یعنی خواب نه فاجعه است، نه ایدئال. " +
          "ممکن است بعضی شب‌ها طول بکشد تا خوابت ببرد یا صبح‌ها با احساس خستگی نسبی بیدار شوی.",
        "کیفیت خواب متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "psqi_poor",
        "نمره‌ی بالا (کیفیت خواب ضعیف) نشان می‌دهد که خواب در چند بعد دچار اختلال است و می‌تواند در کنار استرس، اضطراب یا سبک زندگی، یکی از اهداف اصلی مداخله باشد.",
        "کیفیت خواب پایین",
        "high"
      ),
    ];
  }

  return [];
};

/**
 * Focus – تمرکز و توجه
 */
const handleFocus: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "focus_low",
        "نمره‌ی پایین یعنی در حال حاضر حفظ تمرکز، ماندن روی یک کار یا جمع کردن حواس برایت چالش‌برانگیز است. " +
          "این می‌تواند به استرس، خواب، افسردگی، ADHD یا عوامل محیطی هم ربط داشته باشد.",
        "تمرکز و توجه پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "focus_medium",
        "نمره‌ی متوسط یعنی گاهی تمرکز خوبی داری و گاهی حواست زود پرت می‌شود؛ " +
          "چیزی بین «نوسان طبیعی» و «چالش جدی» است.",
        "تمرکز نوسانی"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "focus_high",
        "نمره‌ی بالا نشان می‌دهد در بسیاری از موقعیت‌ها می‌توانی توجه‌ات را روی کاری که مهم است نگه داری، " +
          "حتی وقتی اطراف‌ات محرک زیاد باشد.",
        "تمرکز خوب"
      ),
    ];
  }

  return [];
};

/**
 * MAAS – ذهن‌آگاهی
 */
const handleMAAS: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "maas_low",
        "نمره‌ی پایین یعنی بیشتر اوقات روی حالت «اتوماتیک» هستی؛ حواست جای دیگری است، " +
          "حین کار چیز دیگری در ذهنت می‌گذرد و کمتر در لحظه‌ی اکنون حاضر می‌مانی.",
        "ذهن‌آگاهی پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "maas_medium",
        "نمره‌ی متوسط یعنی هم لحظاتی از حضور و آگاهی در لحظه داری و هم لحظاتی که حواست پخش و پلا می‌شود. " +
          "با تمرین‌های ساده‌ی ذهن‌آگاهی می‌توانی سهم لحظاتِ حضور را بیشتر کنی.",
        "ذهن‌آگاهی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "maas_high",
        "نمره‌ی بالا یعنی نسبتاً خوب می‌توانی متوجه حالت درونی، بدن و محیطت باشی، " +
          "بدون این‌که فوراً قضاوت کنی یا واکنش نشان بدهی. این مهارت یک عامل مهم در تنظیم استرس و هیجان است.",
        "ذهن‌آگاهی خوب"
      ),
    ];
  }

  return [];
};

/**
 * Rosenberg – عزت نفس
 */
const handleRosenberg: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "rosenberg_low",
        "نمره‌ی پایین در این تست یعنی تصویر کلی‌ات از خودت همراه با تردید، انتقاد شدید یا احساس «کافی نبودن» است. " +
          "این به این معنا نیست که واقعاً کم‌ارزش هستی؛ بلکه ذهن‌ات فعلاً با عینکی سخت‌گیر به خودت نگاه می‌کند.",
        "عزت نفس پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "rosenberg_medium",
        "نمره‌ی متوسط یعنی هم لحظاتی داری که روی خودت حساب می‌کنی و هم لحظاتی که شدیدتر خودت را قضاوت می‌کنی. " +
          "این سطح بسیار رایج است و با کار کردن روی خودمهربانی و تنظیم توقعات قابل رشد است.",
        "عزت نفس متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "rosenberg_high",
        "نمره‌ی بالا یعنی به‌طور کلی احساس می‌کنی در هسته‌ی وجودت ارزشمند هستی، حتی اگر همیشه همه‌چیز طبق برنامه پیش نرود. " +
          "این یک منبع مهم برای تاب‌آوری در برابر شکست‌ها و نقدهای بیرونی است.",
        "عزت نفس بالا"
      ),
    ];
  }

  return [];
};

/**
 * SWLS – رضایت از زندگی
 */
const handleSWLS: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "swls_low",
        "نمره‌ی پایین یعنی در حال حاضر فاصله‌ی قابل توجهی بین زندگی‌ای که داری و زندگی‌ای که آرزو داری وجود دارد. " +
          "این احساس می‌تواند دردناک باشد، اما همین آگاهی نقطه‌ی شروع طراحی تغییرات واقعی است.",
        "رضایت از زندگی پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "swls_medium",
        "نمره‌ی متوسط یعنی بعضی بخش‌های زندگی‌ات برایت رضایت‌بخش هستند و بعضی دیگر نه؛ تصویر کلی، ترکیبی از رضایت و نارضایتی است.",
        "رضایت از زندگی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "swls_high",
        "نمره‌ی بالا نشان می‌دهد در مجموع از مسیر زندگی‌ات – با وجود همه‌ی نقص‌ها – احساس رضایت نسبی تا بالایی داری و بخش‌های مهم زندگی‌ات با ارزش‌ها و خواسته‌هایت هماهنگ‌تر هستند.",
        "رضایت از زندگی بالا"
      ),
    ];
  }

  return [];
};

/**
 * EQ – هوش هیجانی
 */
const handleEQ: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "eq_low",
        "نمره‌ی پایین در هوش هیجانی یعنی در حال حاضر ممکن است شناسایی، نام‌گذاری و مدیریت احساسات خودت و دیگران برایت چالش‌برانگیز باشد. " +
          "این موضوع قابل آموزش است و می‌تواند کیفیت رابطه‌ها و تصمیم‌ها را عمیقاً عوض کند.",
        "هوش هیجانی پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "eq_medium",
        "نمره‌ی متوسط نشان می‌دهد در بسیاری از موقعیت‌ها می‌توانی احساسات خودت و دیگران را بشناسی و تا حدی مدیریت کنی، " +
          "اما هنوز فضا برای رشد قابل توجه وجود دارد؛ مخصوصاً در موقعیت‌های پرتنش.",
        "هوش هیجانی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "eq_high",
        "نمره‌ی بالا یعنی معمولاً خوب متوجه احساسات خودت و دیگران می‌شوی، می‌توانی آن‌ها را به زبان بیاوری و اغلب واکنش‌هایی انتخاب می‌کنی که ارتباط را حفظ می‌کند و به حل مسئله کمک می‌کند.",
        "هوش هیجانی بالا"
      ),
    ];
  }

  return [];
};

/**
 * PANAS – عاطفه مثبت/منفی
 */
const handlePANAS: TestInterpretationHandler = (r) => {
  const chunks: InterpretationChunk[] = [];

  // انتظار: subscales شامل دو مورد PA و NA
  const pa = r.subscales.find((s) => s.id === "PA");
  const na = r.subscales.find((s) => s.id === "NA");

  if (pa) {
    if (pa.score < 2.5) {
      chunks.push(
        chunk(
          "panas_pa_low",
          "نمره‌ی پایین در عاطفه‌ی مثبت یعنی در این بازه‌ی زمانی کمتر احساس شوق، لذت، هیجان مثبت یا انگیزه را تجربه کرده‌ای. " +
            "این می‌تواند به خستگی، فشار یا شرایط محیطی هم مربوط باشد.",
          "عاطفه‌ی مثبت پایین"
        )
      );
    } else if (pa.score < 3.5) {
      chunks.push(
        chunk(
          "panas_pa_medium",
          "نمره‌ی متوسط در عاطفه‌ی مثبت یعنی ترکیبی از لحظات خوب و خنثی را تجربه می‌کنی، بدون این‌که هیچ‌کدام خیلی غالب باشند.",
          "عاطفه‌ی مثبت متوسط"
        )
      );
    } else {
      chunks.push(
        chunk(
          "panas_pa_high",
          "نمره‌ی بالای عاطفه‌ی مثبت یعنی زندگی‌ات در این دوره پر از لحظات مثبت، انگیزه، علاقه و درگیر شدن با فعالیت‌های معنادار بوده است.",
          "عاطفه‌ی مثبت بالا"
        )
      );
    }
  }

  if (na) {
    if (na.score < 2.5) {
      chunks.push(
        chunk(
          "panas_na_low",
          "سطح عاطفه‌ی منفی پایین است؛ یعنی احساس‌هایی مثل خشم، شرم، ترس یا غم شدید در این دوره کمتر غالب بوده‌اند.",
          "عاطفه‌ی منفی پایین"
        )
      );
    } else if (na.score < 3.5) {
      chunks.push(
        chunk(
          "panas_na_medium",
          "مقداری عاطفه‌ی منفی حضور دارد، اما نه در حدی که کاملاً فضا را قبضه کند.",
          "عاطفه‌ی منفی متوسط"
        )
      );
    } else {
      chunks.push(
        chunk(
          "panas_na_high",
          "عاطفه‌ی منفی بالا یعنی احساس‌های ناخوشایند، سهم قابل توجهی از فضای روانی‌ات را گرفته‌اند. " +
            "این لزوماً به معنی بیماری نیست؛ اما نشانه‌ای است که فشارها، تعارض‌ها یا کمبود ریکاوری را جدی‌تر ببینی.",
          "عاطفه‌ی منفی بالا"
        )
      );
    }
  }

  return chunks;
};

/**
 * UCLA – احساس تنهایی
 */
const handleUCLA: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "ucla_low",
        "نمره‌ی پایین یعنی احساس تنهایی مزمن یا پریشان‌کننده در این دوره غالب نیست. " +
          "ممکن است گاهی تنها باشی، اما این تنهایی بیشتر از جنس انتخاب یا فرصت است تا رنج شدید.",
        "احساس تنهایی پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "ucla_medium",
        "نمره‌ی متوسط یعنی گاهی احساس می‌کنی از نظر عاطفی «کم‌پشت» شده‌ای؛ " +
          "شاید آدم‌هایی دور و برت باشند، اما همیشه احساس نمی‌کنی واقعاً دیده و فهمیده می‌شوی.",
        "احساس تنهایی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "ucla_high",
        "نمره‌ی بالا یعنی تنهایی – چه به شکل تنهایی بیرونی، چه به شکل احساس تنهایی در جمع – بخش مهمی از تجربه‌ی این روزهایت است. " +
          "این احساس کاملاً انسانی است، اما اگر طولانی شود می‌تواند روی خلق و سلامت روان هم اثر بگذارد.",
        "احساس تنهایی بالا"
      ),
    ];
  }

  return [];
};

/**
 * SPIN – اضطراب اجتماعی
 */
const handleSPIN: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "spin_low",
        "نشانه‌های اضطراب اجتماعی در این تست کم است؛ یعنی حضور در جمع، صحبت‌کردن و تعامل با دیگران معمولاً برایت به‌طور شدید تهدیدکننده نیست، هرچند ممکن است گاهی استرس طبیعی داشته باشی.",
        "اضطراب اجتماعی پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "spin_medium",
        "نمره‌ی متوسط یعنی در موقعیت‌های اجتماعی (مثل حرف‌زدن در جمع، آشنا شدن با آدم‌های جدید، یا مورد قضاوت بودن) مقداری نگرانی و خودآگاهی شدید تجربه می‌کنی، اما لزوماً فلج‌کننده نیست.",
        "اضطراب اجتماعی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "spin_high",
        "نمره‌ی بالا نشان می‌دهد ترس از قضاوت شدن، شرمندگی، اشتباه کردن در جمع یا دیده شدن، فشار قابل توجهی روی تو می‌گذارد و ممکن است باعث شود از بعضی موقعیت‌ها اجتناب کنی.",
        "اضطراب اجتماعی بالا"
      ),
    ];
  }

  return [];
};

/**
 * PSSS – حمایت اجتماعی
 */
const handlePSSS: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "psss_low",
        "نمره‌ی پایین یعنی احساس می‌کنی در موقعیت‌های سخت، آدم‌های زیادی نیستند که بتوانی با خیال راحت به آن‌ها تکیه کنی یا درد‌دل کنی؛ " +
          "یا اگر هستند، احساس نمی‌کنی واقعاً تو را می‌فهمند.",
        "حمایت اجتماعی پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "psss_medium",
        "نمره‌ی متوسط یعنی در بعضی حوزه‌ها (خانواده، دوستان، همکاران) حمایت اجمالاً وجود دارد، " +
          "اما ممکن است هنوز احساس کنی از نظر عاطفی یا عملی، جا برای بهتر شدن هست.",
        "حمایت اجتماعی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "psss_high",
        "نمره‌ی بالا یعنی احساس می‌کنی تنها نیستی؛ آدم‌هایی در زندگی‌ات هستند که اگر لازم باشد، می‌توانی روی حمایت عاطفی، فکری یا عملی‌شان حساب کنی.",
        "حمایت اجتماعی بالا"
      ),
    ];
  }

  return [];
};

/**
 * GeneralHealth – سلامت کلی
 */
const handleGeneralHealth: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "gh_low",
        "نمره‌ی پایین یعنی در این دوره، از نظر ترکیبیِ جسمی و روانی، احساس خوبی نسبت به وضعیت سلامتت نداری؛ " +
          "ممکن است خستگی، درد، مشکلات گوارشی، خواب یا خلق در هم تنیده شده باشند.",
        "سلامت کلی پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "gh_medium",
        "نمره‌ی متوسط یعنی ترکیبی از روزهای خوب و نه‌چندان خوب را تجربه می‌کنی؛ " +
          "بعضی جنبه‌های سلامتی‌ات قابل قبول است و بعضی بخش‌ها نیاز به توجه بیشتری دارند.",
        "سلامت کلی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "gh_high",
        "نمره‌ی بالا نشان می‌دهد در مجموع از وضعیت سلامتی‌ات – حداقل در این بازه – احساس نسبتاً خوبی داری.",
        "سلامت کلی خوب"
      ),
    ];
  }

  return [];
};

/**
 * EatingHabits – عادات غذایی
 */
const handleEatingHabits: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "eat_low",
        "نمره‌ی پایین یعنی الگوی غذایی‌ات در حال حاضر از نظر نظم، کیفیت یا تنوع، فاصله‌ی قابل توجهی با آن‌چیزی دارد که بدنت برای ریکاوری و انرژی پایدار نیاز دارد.",
        "عادات غذایی نامناسب"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "eat_medium",
        "نمره‌ی متوسط یعنی بعضی عادت‌هایت مفید هستند و بعضی دیگر (مثل ریزه‌خواری، پرخوری، وعده‌های نامنظم) می‌توانند بهتر شوند.",
        "عادات غذایی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "eat_high",
        "نمره‌ی بالا یعنی به‌طور کلی الگوی غذایی‌ات از نظر نظم، کیفیت و توجه به بدن، تصویر نسبتاً سالمی را نشان می‌دهد.",
        "عادات غذایی سالم"
      ),
    ];
  }

  return [];
};

/**
 * PhysicalActivity – فعالیت بدنی
 */
const handlePhysicalActivity: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "pa_low",
        "نمره‌ی پایین یعنی بدنت حرکت و فعالیت منظم کمتری از آن‌چه برای سلامت قلب، مغز و خلق نیاز دارد، دریافت می‌کند. " +
          "این لزوماً به معنی تنبلی نیست؛ بیشتر به ترکیب شرایط و اولویت‌ها برمی‌گردد.",
        "فعالیت بدنی کم"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "pa_medium",
        "نمره‌ی متوسط یعنی گاهی فعال هستی و گاهی نه؛ احتمالاً می‌توانی با چند تغییر کوچک (مثلاً پیاده‌روی منظم، حرکت‌های کوتاه) وضعیت را ارتقا دهی.",
        "فعالیت بدنی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "pa_high",
        "نمره‌ی بالا یعنی در زندگی‌ات سهمی برای حرکت گذاشته‌ای؛ چیزی که به خواب، خلق، انرژی و حتی تمرکز کمک می‌کند.",
        "فعالیت بدنی مناسب"
      ),
    ];
  }

  return [];
};

/**
 * LearningStyle – سبک یادگیری
 */
const handleLearningStyle: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "ls_low",
        "نتایج نشان می‌دهد سبک یادگیری فعلی‌ات آن‌قدری که می‌تواند مؤثر باشد، برای تو کار نمی‌کند؛ " +
          "ممکن است سریع خسته شوی، حواست پرت شود یا روش‌هایت با مغزت جور نباشد.",
        "سبک یادگیری کم‌اثر"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "ls_medium",
        "سبک یادگیری‌ات در حد متوسط عمل می‌کند؛ " +
          "یعنی در بعضی موقعیت‌ها خوب جواب می‌دهد و در بعضی شرایط نه.",
        "سبک یادگیری متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "ls_high",
        "نمره‌ی بالا یعنی تا حد زیادی فهمیده‌ای چطور بهتر یاد می‌گیری؛ " +
          "مثلاً با مثال، با تمرین، با توضیح‌دادن برای دیگران یا با دیدن تصویر کلی.",
        "سبک یادگیری مؤثر"
      ),
    ];
  }

  return [];
};

/**
 * GrowthMindset – ذهنیت رشد
 */
const handleGrowthMindset: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "gm_low",
        "نمره‌ی پایین یعنی در عمق ذهنت بیشتر باور داری که استعدادها و توانایی‌ها تقریباً ثابت‌اند و شکست بیشتر نشانه‌ی «ناتوانی» است تا یک مرحله از رشد.",
        "ذهنیت رشد پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "gm_medium",
        "نمره‌ی متوسط یعنی در بعضی حوزه‌ها به رشد و یادگیری باور داری و در بعضی حوزه‌ها هنوز شکست را نشانه‌ی «بی‌استعدادی» می‌بینی.",
        "ذهنیت رشد متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "gm_high",
        "نمره‌ی بالا یعنی بیشتر تمایل داری اشتباه و شکست را به‌عنوان بخشی از مسیر یادگیری ببینی و باور داری که می‌توانی با تمرین، بازخورد و زمان رشد کنی.",
        "ذهنیت رشد قوی"
      ),
    ];
  }

  return [];
};

/**
 * Curiosity – کنجکاوی
 */
const handleCuriosity: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "cur_low",
        "نمره‌ی پایین یعنی در این دوره، کمتر به سمت سؤال پرسیدن، کشف کردن، امتحان کردن چیزهای جدید یا فرو رفتن در عمق موضوعات کشیده می‌شوی؛ " +
          "شاید خستگی، فشار یا ترس از اشتباه نقش داشته باشد.",
        "کنجکاوی پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "cur_medium",
        "نمره‌ی متوسط یعنی گاهی در موضوعات مورد علاقه‌ات به‌شدت کنجکاو می‌شوی و گاهی در بقیه‌ی زمینه‌ها کمتر درگیر می‌شوی.",
        "کنجکاوی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "cur_high",
        "نمره‌ی بالا یعنی ذهنی جست‌وجوگر داری؛ دوست داری بدانی پشت پرده‌ی پدیده‌ها چیست، چرا چیزها این‌طور شده‌اند و چطور می‌شود بهترشان کرد.",
        "کنجکاوی بالا"
      ),
    ];
  }

  return [];
};

/**
 * Adaptability – انطباق‌پذیری
 */
const handleAdaptability: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "adapt_low",
        "نمره‌ی پایین یعنی تغییرات، اتفاق‌های غیرمنتظره یا محیط‌های جدید برایت خیلی استرس‌زا و خسته‌کننده هستند و ممکن است زمان زیادی طول بکشد تا با آن‌ها کنار بیایی.",
        "انطباق‌پذیری پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "adapt_medium",
        "نمره‌ی متوسط یعنی در بسیاری از تغییرها می‌توانی خودت را وفق بدهی، اما در تغییرهای بزرگ‌تر یا هم‌زمان، تحت فشار زیادی قرار می‌گیری.",
        "انطباق‌پذیری متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "adapt_high",
        "نمره‌ی بالا یعنی معمولاً می‌توانی خودت، برنامه‌هایت و انتظارهایت را با شرایط جدید هماهنگ کنی، بدون این‌که هویت‌ات را گم کنی.",
        "انطباق‌پذیری بالا"
      ),
    ];
  }

  return [];
};

/**
 * Innovation – نوآوری
 */
const handleInnovation: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "innov_low",
        "نمره‌ی پایین یعنی فعلاً ترجیح می‌دهی بیشتر از راه‌های امتحان‌شده و آشنا استفاده کنی " +
          "و تبدیل ایده‌ها به عمل برایت چالش‌برانگیزتر است.",
        "نوآوری پایین"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "innov_medium",
        "نمره‌ی متوسط یعنی گاهی ایده‌های جدید می‌دهی و گاهی از مسیرهای تکراری استفاده می‌کنی؛ " +
          "ضمن این‌که اجرای ایده‌ها همیشه آسان نیست.",
        "نوآوری متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "innov_high",
        "نمره‌ی بالا یعنی هم تمایل به ساختن و امتحان کردن چیزهای جدید داری، " +
          "هم می‌توانی ایده‌ها را وارد عمل کنی و از شکست‌های احتمالی هم یاد بگیری.",
        "نوآوری بالا"
      ),
    ];
  }

  return [];
};

/**
 * Hobbies – علایق و سرگرمی‌ها
 */
const handleHobbies: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  if (level === "low") {
    return [
      chunk(
        "hob_low",
        "نمره‌ی پایین یعنی در این دوره زندگی‌ات احتمالاً کم‌فعالیت‌تر یا کم‌لذت‌تر از چیزی است که دلت می‌خواهد؛ " +
          "شاید وقت یا انرژی کافی برای سرگرمی‌ها و علایقی که دوست داری پیدا نکرده‌ای.",
        "سرگرمی و لذت کم"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "hob_medium",
        "نمره‌ی متوسط یعنی بعضی سرگرمی‌ها و علایق در زندگی‌ات حضور دارند، " +
          "اما هنوز جا برای پررنگ‌تر شدن لذت، بازی و فعالیت‌های غیرکاری وجود دارد.",
        "سرگرمی متوسط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "hob_high",
        "نمره‌ی بالا یعنی برای چیزهایی که صرفاً برای لذت، کنجکاوی یا استراحت روانی انجام می‌دهی جا باز کرده‌ای؛ " +
          "این خودش یک عامل محافظتی مهم در برابر فرسودگی است.",
        "سرگرمی و علایق پررنگ"
      ),
    ];
  }

  return [];
};

/**
 * Values – ارزش‌های شخصی
 */
const handleValues: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;
  if (!level) return [];

  return [
    chunk(
      "values_generic",
      "این تست نشان می‌دهد ارزش‌های شخصی‌ات نقش مهمی در تصمیم‌ها و رضایت از زندگی‌ات دارند. " +
        "در تحلیل کامل‌تر می‌توان دید کدام ارزش‌ها (مثل رشد فردی، کمک به دیگران، آزادی، ثبات) برای تو پررنگ‌تر هستند " +
        "و چقدر زندگی فعلی‌ات با این ارزش‌ها هماهنگ است.",
      "ارزش‌های شخصی"
    ),
  ];
};

/**
 * TimePreference – ترجیح زمانی
 */
const handleTimePreference: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;

  if (!level) {
    return [
      chunk(
        "tp_generic",
        "این تست تصویری کلی از ترجیح تو بین پاداش‌های کوتاه‌مدت و بلندمدت می‌دهد. " +
          "این‌که بیشتر سراغ لذت‌های فوری می‌روی یا حاضری برای اهداف بلندمدت صبر کنی، می‌تواند روی پول، سلامت و شغل تأثیر بگذارد.",
        "ترجیح زمانی"
      ),
    ];
  }

  if (level === "low") {
    return [
      chunk(
        "tp_now",
        "نتیجه نشان می‌دهد بیشتر تمایل داری پاداش‌های کوچک و فوری را به پاداش‌های بزرگ‌تر ولی دیرتر ترجیح بدهی؛ " +
          "این می‌تواند در پس‌انداز، سلامت و پروژه‌های بلندمدت تأثیر بگذارد.",
        "تمرکز بر حال"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "tp_balanced",
        "نمره‌ی متوسط یعنی در بسیاری از موقعیت‌ها می‌توانی بین لذت کوتاه‌مدت و هدف بلندمدت تعادل برقرار کنی.",
        "تعادل حال و آینده"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "tp_future",
        "نمره‌ی بالا یعنی بیشتر تمایل داری پیامدهای بلندمدت تصمیم‌ها را ببینی و برای آینده برنامه‌ریزی کنی، حتی اگر الان کمی سخت‌تر باشد.",
        "تمرکز بر آینده"
      ),
    ];
  }

  return [];
};

/**
 * IdealEnvironment – محیط ایده‌آل
 */
const handleIdealEnvironment: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;

  if (!level) {
    return [
      chunk(
        "env_generic",
        "این تست کمک می‌کند بفهمی چه نوع محیطی (از نظر صدا، نور، تعامل، ساختار) با تو سازگارتر است. " +
          "هماهنگ بودن محیط با ترجیحات تو می‌تواند تمرکز، خلق و انرژی‌ات را بالا ببرد.",
        "محیط ایده‌آل"
      ),
    ];
  }

  if (level === "low") {
    return [
      chunk(
        "env_mismatch",
        "نمره‌ی پایین یعنی محیطی که در آن زندگی یا کار می‌کنی، از نظر صدا، نور، میزان تعامل، ساختار یا تنوع، خیلی با ترجیحات طبیعی تو نمی‌خواند " +
          "و همین می‌تواند بخشی از خستگی یا حواس‌پرتی‌ات را توضیح دهد.",
        "عدم تناسب محیط"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "env_partial",
        "نمره‌ی متوسط یعنی بعضی بخش‌های محیط با تو جور هستند و بعضی نه؛ " +
          "مثلاً ممکن است سکوت را دوست داشته باشی اما در محیط شلوغ کار کنی.",
        "تناسب نسبی محیط"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "env_good",
        "نمره‌ی بالا یعنی به‌طور کلی محیط‌های فعلی‌ات با ترجیحات حسی، اجتماعی و ساختاری تو هماهنگ‌تر هستند " +
          "و همین، کار و یادگیری را برایت آسان‌تر می‌کند.",
        "تناسب خوب محیط"
      ),
    ];
  }

  return [];
};

/**
 * CareerFuture – آینده شغلی
 */
const handleCareerFuture: TestInterpretationHandler = (r) => {
  const level = r.totalLevelId;

  if (!level) {
    return [
      chunk(
        "career_generic",
        "این تست کمک می‌کند ببینی تصویرت از آینده‌ی شغلی چقدر روشن، منسجم و واقع‌بینانه است.",
        "آینده شغلی"
      ),
    ];
  }

  if (level === "low") {
    return [
      chunk(
        "career_low",
        "نمره‌ی پایین یعنی تصویر آینده‌ی شغلی‌ات در حال حاضر مبهم، پر از سؤال یا همراه با تردید است. " +
          "این حالت رایج‌تر از چیزی است که فکر می‌کنیم و می‌تواند نقطه‌ی شروع خوبی برای کاوش بیشتر باشد.",
        "ابهام در آینده شغلی"
      ),
    ];
  }

  if (level === "medium") {
    return [
      chunk(
        "career_medium",
        "نمره‌ی متوسط یعنی بعضی چیزها را درباره‌ی مسیر شغلی‌ات می‌دانی، " +
          "اما هنوز در چند تصمیم کلیدی (مثل جهت، حوزه، سبک کار) تردید یا ابهام وجود دارد.",
        "آینده شغلی نیمه‌شفاف"
      ),
    ];
  }

  if (level === "high") {
    return [
      chunk(
        "career_high",
        "نمره‌ی بالا نشان می‌دهد که تصویر نسبتاً روشنی از مسیر شغلی دلخواهت و قدم‌های مهمی که باید برداری داری، حتی اگر همه‌چیز هنوز عملی نشده باشد.",
        "تصویر روشن از آینده شغلی"
      ),
    ];
  }

  return [];
};

/**
 * Generic Skill Handler برای مهارت‌های فردی/سازمانی
 */
const genericSkillHandler =
  (labelFa: string): TestInterpretationHandler =>
  (r) => {
    const level = r.totalLevelId;
    if (!level) return [];

    if (level === "low") {
      return [
        chunk(
          `${r.testId}_low`,
          `نمره‌ی پایین یعنی در حال حاضر این مهارت («${labelFa}») برایت چالش‌برانگیزتر است و جا برای رشد زیادی دارد. ` +
            "این مهارت کاملاً قابل تمرین و یادگیری است.",
          `${labelFa} – سطح پایین`
        ),
      ];
    }

    if (level === "medium") {
      return [
        chunk(
          `${r.testId}_medium`,
          `نمره‌ی متوسط یعنی در بسیاری از موقعیت‌ها در «${labelFa}» عملکرد قابل قبولی داری، ` +
            "اما در موقعیت‌های سخت یا پیچیده هنوز می‌توانی رشد کنی.",
          `${labelFa} – سطح متوسط`
        ),
      ];
    }

    if (level === "high") {
      return [
        chunk(
          `${r.testId}_high`,
          `نمره‌ی بالا یعنی مهارت «${labelFa}» یکی از نقاط قوت توست و می‌توانی روی آن برای رشد شغلی و فردی حساب کنی.`,
          `${labelFa} – نقطه قوت`
        ),
      ];
    }

    return [];
  };

/**
 * ============================================
 * هندلرهای تیپ‌محور (Profile-Based Handlers)
 * ============================================
 */

/**
 * MBTI – تیپ شخصیتی ۴ حرفی
 */
const handleMBTI: TestInterpretationHandler = (r) => {
  // انتظار داریم subscales: EI, SN, TF, JP
  const ei = r.subscales.find((s) => s.id === "EI");
  const sn = r.subscales.find((s) => s.id === "SN");
  const tf = r.subscales.find((s) => s.id === "TF");
  const jp = r.subscales.find((s) => s.id === "JP");

  // اگر ساختار فعلی‌ات فرق می‌کند، بعداً فقط این بخش را با واقعیت تنظیم کن
  if (!ei || !sn || !tf || !jp) {
    return [
      chunk(
        "mbti_missing",
        "نتیجه‌ی این تست به‌صورت کامل در دسترس نیست، اما در نسخه‌ی بعدی تستولوژی پروفایل تیپ MBTI تو با جزئیات کامل نمایش داده می‌شود.",
        "تفسیر MBTI"
      ),
    ];
  }

  const midpoint = 3; // فرض: میانگین ۱ تا ۵

  const eOrI = ei.score >= midpoint ? "E" : "I";
  const sOrN = sn.score >= midpoint ? "S" : "N";
  const tOrF = tf.score >= midpoint ? "T" : "F";
  const jOrP = jp.score >= midpoint ? "J" : "P";

  const type = `${eOrI}${sOrN}${tOrF}${jOrP}`;

  const dimDesc: string[] = [];

  dimDesc.push(
    eOrI === "E"
      ? "در بُعد برون‌گرایی/درون‌گرایی، کمی بیشتر به سمت برون‌گرایی متمایلی: راحت‌تر با دیگران ارتباط می‌گیری و از بودن در جمع انرژی می‌گیری، هرچند ممکن است هنوز به زمان‌های تنهایی هم نیاز داشته باشی."
      : "در بُعد برون‌گرایی/درون‌گرایی، کمی بیشتر به سمت درون‌گرایی متمایلی: عمیق‌تر فکر می‌کنی، از زمان‌های تنهایی برای شارژ شدن استفاده می‌کنی و ترجیح می‌دهی رابطه‌هایت معنادار و عمیق باشند تا خیلی گسترده."
  );

  dimDesc.push(
    sOrN === "S"
      ? "در بُعد شهود/حسی، تمایلت کمی بیشتر به سمت حسی است: به جزئیات واقعی، تجربه‌ی مستقیم و داده‌های قابل مشاهده بیشتر تکیه می‌کنی."
      : "در بُعد شهود/حسی، تمایلت کمی بیشتر به سمت شهودی است: دوست داری الگوها، ایده‌ها و تصویر کلی را ببینی و از تخیل و ارتباط دادن چیزها لذت می‌بری."
  );

  dimDesc.push(
    tOrF === "T"
      ? "در بُعد منطقی/احساسی، گرایش‌ات کمی به سمت تحلیل و منطق است: سعی می‌کنی تصمیم‌ها را بر اساس معیار، استدلال و عدالت بگیری، حتی اگر همیشه آسان نباشد."
      : "در بُعد منطقی/احساسی، گرایش‌ات کمی به سمت احساس و رابطه‌ها است: برایت مهم است که تصمیم‌ها چه اثری روی خودت و آدم‌های اطرافت می‌گذارد و همدلی نقش پررنگی در انتخاب‌هایت دارد."
  );

  dimDesc.push(
    jOrP === "J"
      ? "در بُعد قضاوت/ادراک، تمایلت کمی بیشتر به سمت ساختار و برنامه است: دوست داری تکلیف کارها روشن باشد، زودتر تصمیم بگیری و برنامه داشته باشی."
      : "در بُعد قضاوت/ادراک، تمایلت کمی بیشتر به سمت انعطاف و بازبودن است: دوست داری گزینه‌ها باز بمانند، فرصتِ تغییر مسیر داشته باشی و با جریان پیش بروی."
  );

  const analysisChunks: InterpretationChunk[] = [
    chunk(
      "mbti_type",
      `در این تست، پروفایل کلی تو به تیپ شخصیتی ${type} نزدیک‌تر است. این یک برچسب قطعی یا محدودکننده نیست، بلکه زبانی است برای توضیح الگوهای غالب در فکر کردن، احساس کردن و ارتباط برقرار کردن تو.`,
      "تیپ کلی MBTI",
      "normal",
      "analysis"
    ),
    chunk(
      "mbti_dims",
      dimDesc.join("\n\n"),
      "ابعاد چهارگانه‌ی تیپ تو",
      "normal",
      "analysis"
    ),
    chunk(
      "mbti_note",
      "هیچ تیپی بهتر یا بدتر از دیگری نیست. مهم این است که این الگوها را بشناسی، در جاهایی که به تو قدرت می‌دهند از آن‌ها استفاده کنی و در جاهایی که کار را برایت سخت می‌کنند، ابزارهای مکمل یاد بگیری.",
      undefined,
      "normal",
      "analysis"
    ),
  ];

  const recConfig = MBTI_RECOMMENDATIONS[type];
  const recChunks: InterpretationChunk[] = recConfig
    ? [
        chunk(
          `mbti_${type}_rec_title`,
          recConfig.title,
          "تست‌های تکمیلی پیشنهادی",
          "normal",
          "recommendation"
        ),
        ...recConfig.items.map((item, index) =>
          chunk(
            `mbti_${type}_rec_${index}`,
            `● ${item.testId} — ${item.message}`,
            undefined,
            "normal",
            "recommendation"
          )
        ),
      ]
    : [];

  return [...analysisChunks, ...recChunks];
};

/**
 * Big Five Interpreter (مشترک برای NEO-FFI و BFI)
 */
const interpretBigFive = (r: ScoredResult, label: string): InterpretationChunk[] => {
  const traits = {
    N: r.subscales.find((s) => s.id === "N"),
    E: r.subscales.find((s) => s.id === "E"),
    O: r.subscales.find((s) => s.id === "O"),
    A: r.subscales.find((s) => s.id === "A"),
    C: r.subscales.find((s) => s.id === "C"),
  };

  const presentTraits = Object.values(traits).filter(Boolean);
  if (presentTraits.length === 0) {
    return [
      chunk(
        `${r.testId}_missing`,
        `ساختار نمرات این تست هنوز در سیستم تنظیم نشده، اما در نسخه بعدی تستولوژی پروفایل کامل Big Five برای تست «${label}» نمایش داده می‌شود.`,
        label
      ),
    ];
  }

  const describe = (tId: keyof typeof traits, faName: string) => {
    const t = traits[tId];
    if (!t) return null;

    const v = t.score;
    if (v <= 2.4) {
      if (tId === "N") {
        return `• ${faName} (N): در این بُعد، نمره‌ات پایین است؛ یعنی در بسیاری از موقعیت‌ها ثبات هیجانی بیشتری داری و شاید کمتر با موج‌های شدید اضطراب، خشم یا غم درگیر می‌شوی – البته این به معنای نداشتن احساس نیست.`;
      }
      if (tId === "E") {
        return `• ${faName} (E): در این بُعد، نمره‌ات پایین است؛ یعنی بیشتر به سمت درون‌گرایی تمایل داری، از جمع‌های شلوغ زودتر خسته می‌شوی و به زمان تنهایی و ارتباط‌های عمیق‌تر علاقه‌مندی.`;
      }
      if (tId === "O") {
        return `• ${faName} (O): نمره پایین یعنی بیشتر به سمت واقع‌گرایی و ساختار آشنا مایلی تا تجربه‌های خیلی غیرمعمول یا ریسکی.`;
      }
      if (tId === "A") {
        return `• ${faName} (A): نمره پایین می‌تواند نشان دهد که بیشتر مستقیم و صریح هستی و همیشه تمایل نداری خودت را با خواسته‌ی دیگران هماهنگ کنی، حتی اگر به قیمت تعارض باشد.`;
      }
      if (tId === "C") {
        return `• ${faName} (C): نمره پایین یعنی نظم، برنامه‌ریزی و پیگیری کارها برایت می‌تواند چالش‌برانگیزتر باشد؛ شاید بیشتر با موج انگیزه کار کنی تا با ساختار ثابت.`;
      }
    } else if (v < 3.5) {
      if (tId === "N") {
        return `• ${faName} (N): نمره‌ات در حد متوسط است؛ یعنی گاهی تحت‌تأثیر موج‌های هیجانی قرار می‌گیری و گاهی هم می‌توانی خودت را جمع کنی و ادامه دهی.`;
      }
      if (tId === "E") {
        return `• ${faName} (E): نمره‌ی متوسط یعنی هم به جمع‌ها و ارتباط‌ها علاقه داری و هم به زمان‌های تنهایی؛ بسته به شرایط، یکی از این دو را انتخاب می‌کنی.`;
      }
      if (tId === "O") {
        return `• ${faName} (O): در این بُعد، ترکیبی از علاقه به چیزهای آشنا و کنجکاوی نسبت به تجربه‌های جدید دیده می‌شود.`;
      }
      if (tId === "A") {
        return `• ${faName} (A): نمره متوسط یعنی معمولاً سعی می‌کنی هم خودت را در نظر بگیری هم دیگران را؛ نه همیشه با همه همراه می‌شوی و نه همیشه در موضع تقابل می‌مانی.`;
      }
      if (tId === "C") {
        return `• ${faName} (C): در این بُعد، گاهی منظم و پیگیر هستی و گاهی هم کارها عقب می‌افتند؛ ترکیبی از ساختار و انعطاف.`;
      }
    } else {
      if (tId === "N") {
        return `• ${faName} (N): نمره بالا یعنی حساسیت هیجانی بیشتری داری؛ احساس‌ها را عمیق‌تر تجربه می‌کنی و استرس یا نگرانی می‌تواند تأثیر پررنگ‌تری رویت داشته باشد.`;
      }
      if (tId === "E") {
        return `• ${faName} (E): نمره بالا یعنی از تعامل، صحبت و بودن در کنار آدم‌ها انرژی می‌گیری و معمولاً در جمع‌ها فعال‌تر هستی.`;
      }
      if (tId === "O") {
        return `• ${faName} (O): نمره بالا یعنی ذهنی باز و کنجکاو داری؛ از ایده‌های جدید، تجربه‌های غیرمعمول و دیدن دنیا از زاویه‌های تازه لذت می‌بری.`;
      }
      if (tId === "A") {
        return `• ${faName} (A): نمره بالا یعنی برای هماهنگی، همدلی و کمک به دیگران ارزش زیادی قائلی و سعی می‌کنی تعارض را کاهش دهی.`;
      }
      if (tId === "C") {
        return `• ${faName} (C): نمره بالا یعنی برای نظم، مسئولیت‌پذیری و انجام دقیق کارها اهمیت زیادی قائلی و معمولاً می‌توان رویت حساب کرد.`;
      }
    }
    return null;
  };

  const lines = [
    describe("N", "روان‌رنجوری / ثبات هیجانی"),
    describe("E", "برون‌گرایی"),
    describe("O", "گشودگی به تجربه"),
    describe("A", "سازگاری / توافق‌پذیری"),
    describe("C", "باوجدان بودن / وظیفه‌شناسی"),
  ].filter(Boolean) as string[];

  return [
    chunk(
      `${r.testId}_bigfive_intro`,
      `این تست نمایی از پروفایل Big Five شخصیت تو ارائه می‌دهد. در ادامه، هر یک از پنج عامل اصلی به‌طور خلاصه توضیح داده شده است.`,
      label
    ),
    chunk(
      `${r.testId}_bigfive_dims`,
      lines.join("\n\n"),
      "پروفایل پنج عاملی شخصیت"
    ),
  ];
};

const handleNEO: TestInterpretationHandler = (r) =>
  interpretBigFive(r, "تست شخصیت NEO-FFI");

const handleBFI: TestInterpretationHandler = (r) =>
  interpretBigFive(r, "تست شخصیت BFI");

/**
 * RIASEC – تیپ شغلی
 */
const handleRIASEC: TestInterpretationHandler = (r) => {
  const codes = ["R", "I", "A", "S", "E", "C"] as const;
  const map = Object.fromEntries(
    codes.map((c) => [c, r.subscales.find((s) => s.id === c) || null])
  ) as Record<(typeof codes)[number], (typeof r.subscales)[number] | null>;

  const existing = codes
    .map((c) => map[c])
    .filter((s): s is (typeof r.subscales)[number] => !!s);

  if (existing.length === 0) {
    return [
      chunk(
        "riasec_missing",
        "ساختار نمرات این تست هنوز در سیستم تنظیم نشده، اما در نسخه‌ی بعدی تستولوژی پروفایل کامل RIASEC نمایش داده می‌شود.",
        "تیپ شغلی RIASEC"
      ),
    ];
  }

  const sorted = [...existing].sort((a, b) => b.score - a.score);
  const top3 = sorted.slice(0, 3);

  const nameFa: Record<string, string> = {
    R: "واقع‌گرا (Realistic)",
    I: "پژوهشگر (Investigative)",
    A: "هنری (Artistic)",
    S: "اجتماعی (Social)",
    E: "پرهیاهو / کارآفرین (Enterprising)",
    C: "قراردادی / ساختاریافته (Conventional)",
  };

  const explain = (code: string): string => {
    switch (code) {
      case "R":
        return "تیپ واقع‌گرا دوست دارد با ابزار، اشیاء، دستگاه‌ها یا محیط‌های فیزیکی کار کند و نتیجه‌ی کار را ملموس ببیند.";
      case "I":
        return "تیپ پژوهشگر از تحلیل، تحقیق، فهمیدن پشت‌پرده‌ی مسائل و کار با ایده‌ها و داده‌ها لذت می‌برد.";
      case "A":
        return "تیپ هنری به خلاقیت، بیان خود، کارهای غیرروتین و فضاهای منعطف علاقه‌مند است.";
      case "S":
        return "تیپ اجتماعی از کمک‌کردن به دیگران، آموزش، حمایت و ارتباط انسانی عمیق انرژی می‌گیرد.";
      case "E":
        return "تیپ پرهیاهو / کارآفرین به رهبری، اثرگذاری، قانع‌کردن دیگران و گرفتن تصمیم‌های پرریسک علاقه دارد.";
      case "C":
        return "تیپ قراردادی به نظم، ساختار، داده‌های واضح، قوانین مشخص و چارچوب‌های قابل پیش‌بینی علاقه‌مند است.";
      default:
        return "";
    }
  };

  const lines = top3.map(
    (t, idx) =>
      `${idx + 1}. ${t.id} – ${nameFa[t.id]}\n\n${explain(t.id)}`
  );

  const analysisChunks: InterpretationChunk[] = [
    chunk(
      "riasec_intro",
      "این تست نشان می‌دهد کدام تیپ‌های شغلی در پروفایل تو پررنگ‌تر هستند. این تیپ‌ها نسخه‌ی نهایی سرنوشت نیستند، اما می‌توانند کمک کنند محیط‌ها و نقش‌هایی را پیدا کنی که احتمالاً در آن‌ها حال بهتری داری.",
      "چکیده تیپ شغلی RIASEC",
      "normal",
      "analysis"
    ),
    chunk(
      "riasec_top3",
      lines.join("\n\n"),
      "سه تیپ پررنگ‌تر در پروفایل تو",
      "normal",
      "analysis"
    ),
  ];

  const dominantCode = top3[0].id;
  const recConfig = RIASEC_RECOMMENDATIONS[dominantCode];
  const recChunks: InterpretationChunk[] = recConfig
    ? [
        chunk(
          `riasec_${dominantCode}_rec_title`,
          recConfig.title,
          "تست‌های تکمیلی پیشنهادی",
          "normal",
          "recommendation"
        ),
        ...recConfig.items.map((item, index) =>
          chunk(
            `riasec_${dominantCode}_rec_${index}`,
            `● ${item.testId} — ${item.message}`,
            undefined,
            "normal",
            "recommendation"
          )
        ),
      ]
    : [];

  return [...analysisChunks, ...recChunks];
};

/**
 * Attachment – سبک دلبستگی
 */
const handleAttachment: TestInterpretationHandler = (r) => {
  const styles = ["secure", "anxious", "avoidant", "fearful"] as const;
  const map = Object.fromEntries(
    styles.map((s) => [s, r.subscales.find((x) => x.id === s) || null])
  ) as Record<(typeof styles)[number], (typeof r.subscales)[number] | null>;

  const existing = styles
    .map((s) => map[s])
    .filter((x): x is (typeof r.subscales)[number] => !!x);

  if (existing.length === 0) {
    return [
      chunk(
        "attachment_missing",
        "ساختار نمرات سبک دلبستگی هنوز به‌طور کامل تنظیم نشده است، اما در نسخه‌ی بعدی، پروفایل دقیق‌تری نمایش داده خواهد شد.",
        "سبک دلبستگی"
      ),
    ];
  }

  const primary = [...existing].sort((a, b) => b.score - a.score)[0];

  let body = "";
  switch (primary.id) {
    case "secure":
      body =
        "در این تست، سبک دلبستگی غالب تو به سمت ایمن نزدیک‌تر است. یعنی به‌طور کلی راحت‌تر می‌توانی به دیگران نزدیک شوی، نزدیکی عاطفی برایت جذاب است و اگر رابطه‌ای دچار چالش شود، معمولاً تمام هویتت را زیر سؤال نمی‌برد.";
      break;
    case "anxious":
      body =
        "در این تست، سبک دلبستگی غالب تو به سمت ناایمنِ مضطرب نزدیک‌تر است. یعنی نزدیکی عاطفی برایت مهم است، اما گاهی ترس از رها شدن، دوست‌داشتنی نبودن یا کافی نبودن، ذهن‌ات را در رابطه‌ها فعال نگه می‌دارد.";
      break;
    case "avoidant":
      body =
        "در این تست، سبک دلبستگی غالب تو به سمت ناایمنِ اجتنابی نزدیک‌تر است. یعنی استقلال، کنترل و فاصله‌ی امن برایت خیلی مهم است و صمیمیت زیاد می‌تواند برایت تهدیدکننده یا سنگین به‌نظر برسد.";
      break;
    case "fearful":
      body =
        "در این تست، سبک دلبستگی غالب تو به سمت آمیخته / ترسان نزدیک‌تر است. ترکیبی از تمایل به نزدیکی و ترس از صمیمیت عمیق دیده می‌شود: دوست داری نزدیک شوی، اما هم‌زمان نگران آسیبدیدن یا رها شدن هستی.";
      break;
  }

  const analysisChunks: InterpretationChunk[] = [
    chunk(
      "attachment_main",
      body,
      "الگوی غالب دلبستگی",
      "normal",
      "analysis"
    ),
    chunk(
      "attachment_note",
      "سبک دلبستگی چیزی ثابت و تغییرناپذیر نیست؛ بیشتر داستانی است که مغزت از تجربه‌های گذشته آموخته. با رابطه‌های امن‌تر، خودآگاهی و گاهی کمک حرفه‌ای، این الگوها هم می‌توانند به‌مرور تغییر کنند.",
      undefined,
      "normal",
      "analysis"
    ),
  ];

  const recConfig = ATTACHMENT_RECOMMENDATIONS[primary.id];
  const recChunks: InterpretationChunk[] = recConfig
    ? [
        chunk(
          `attachment_${primary.id}_rec_title`,
          recConfig.title,
          "تست‌های تکمیلی پیشنهادی",
          "normal",
          "recommendation"
        ),
        ...recConfig.items.map((item, index) =>
          chunk(
            `attachment_${primary.id}_rec_${index}`,
            `● ${item.testId} — ${item.message}`,
            undefined,
            "normal",
            "recommendation"
          )
        ),
      ]
    : [];

  return [...analysisChunks, ...recChunks];
};

/**
 * LearningStyle – سبک یادگیری تیپ‌محور
 */
const handleLearningStyleTyped: TestInterpretationHandler = (r) => {
  const styles = ["visual", "auditory", "kinesthetic", "reading_writing"] as const;
  const map = Object.fromEntries(
    styles.map((s) => [s, r.subscales.find((x) => x.id === s) || null])
  ) as Record<(typeof styles)[number], (typeof r.subscales)[number] | null>;

  const existing = styles
    .map((s) => map[s])
    .filter((x): x is (typeof r.subscales)[number] => !!x);

  if (existing.length === 0) {
    // اگر چنین زیرمقیاسی نداشتی، همون هندلر generic قبلی یا fallback کار می‌کنه
    return fallbackInterpretation(r);
  }

  const sorted = [...existing].sort((a, b) => b.score - a.score);
  const top = sorted[0];
  const second = sorted[1];

  const explain = (id: string): string => {
    switch (id) {
      case "visual":
        return "بیشتر وقتی بهتر یاد می‌گیری که چیزها را ببینی: نمودار، تصویر، اسلاید، وایت‌بورد و حتی نقاشی‌کشیدنِ خودت از مفهوم‌ها.";
      case "auditory":
        return "بیشتر وقتی بهتر یاد می‌گیری که بشنوی و صحبت کنی: کلاس تعاملی، پادکست، توضیح شفاهی، یا تعریف‌کردن آموخته‌ها برای دیگران.";
      case "kinesthetic":
        return "بیشتر وقتی بهتر یاد می‌گیری که بدنت درگیر باشد: انجام پروژه عملی، کار با ابزار، نمونه واقعی، بازی و شبیه‌سازی.";
      case "reading_writing":
        return "بیشتر وقتی بهتر یاد می‌گیری که بخوانی و بنویسی: متن، کتاب، مقاله، جزوه‌نویسی، خلاصه‌نویسی و نوشتن ایده‌ها.";
      default:
        return "";
    }
  };

  const lines: string[] = [];

  lines.push(`سبک غالب یادگیری تو در این تست: ${top.id}`);
  lines.push(explain(top.id));

  if (second && second.score >= top.score - 0.3) {
    lines.push(
      "\nهم‌چنین یک سبک فرعی نزدیک هم دیده می‌شود:\n" +
        `${second.id} — ${explain(second.id)}`
    );
  }

  const analysisChunks: InterpretationChunk[] = [
    chunk(
      "learning_style_main",
      "این تست نشان می‌دهد مغزت چه نوع ورودی‌ای را راحت‌تر پردازش می‌کند. اگر محتوا را تا حد ممکن با این سبک تنظیم کنی، یادگیری آسان‌تر و پایدارتر می‌شود.",
      "سبک یادگیری تو",
      "normal",
      "analysis"
    ),
    chunk(
      "learning_style_detail",
      lines.join("\n\n"),
      undefined,
      "normal",
      "analysis"
    ),
  ];

  const recConfig = LEARNING_STYLE_RECOMMENDATIONS[top.id];
  const recChunks: InterpretationChunk[] = recConfig
    ? [
        chunk(
          `ls_${top.id}_rec_title`,
          recConfig.title,
          "تست‌های تکمیلی پیشنهادی",
          "normal",
          "recommendation"
        ),
        ...recConfig.items.map((item, index) =>
          chunk(
            `ls_${top.id}_rec_${index}`,
            `● ${item.testId} — ${item.message}`,
            undefined,
            "normal",
            "recommendation"
          )
        ),
      ]
    : [];

  return [...analysisChunks, ...recChunks];
};

// نگاشت تست‌ها به هندلر اختصاصی
export const TEST_INTERPRETATION_HANDLERS: Record<
  string,
  TestInterpretationHandler
> = {
  GAD7: handleGAD7,
  PHQ9: handlePHQ9,
  PSS: handlePSS,
  StressPSS: handlePSS,
  PSS10: handlePSS,
  LifestyleSleep: handleLifestyleSleep,
  LifestyleSleepQuality: handleLifestyleSleep,
  LifestyleHarmony: handleLifestyleHarmony,
  WorkLifeBalance: handleWorkLifeBalance,
  ISI: handleISI,
  PSQI: handlePSQI,
  Focus: handleFocus,
  FocusAttention: handleFocus,
  MAAS: handleMAAS,
  Rosenberg: handleRosenberg,
  SWLS: handleSWLS,
  EQ: handleEQ,
  PANAS: handlePANAS,
  UCLA: handleUCLA,
  UCLA_Loneliness: handleUCLA,
  SPIN: handleSPIN,
  PSSS: handlePSSS,
  GeneralHealth: handleGeneralHealth,
  EatingHabits: handleEatingHabits,
  PhysicalActivity: handlePhysicalActivity,
  LearningStyle: handleLearningStyleTyped,
  GrowthMindset: handleGrowthMindset,
  Curiosity: handleCuriosity,
  Adaptability: handleAdaptability,
  Innovation: handleInnovation,
  Hobbies: handleHobbies,
  HobbiesInterests: handleHobbies,
  Values: handleValues,
  PersonalValues: handleValues,
  TimePreference: handleTimePreference,
  IdealEnvironment: handleIdealEnvironment,
  CareerFuture: handleCareerFuture,

  Leadership: genericSkillHandler("رهبری"),
  Communication: genericSkillHandler("مهارت ارتباطی"),
  CommunicationSkills: genericSkillHandler("مهارت ارتباطی"),
  Teamwork: genericSkillHandler("کار تیمی"),
  ProblemSolving: genericSkillHandler("حل مسئله"),
  DecisionMaking: genericSkillHandler("تصمیم‌گیری"),
  TimeManagement: genericSkillHandler("مدیریت زمان"),
  StressSkills: genericSkillHandler("مهارت‌های مدیریت استرس"),

  // تیپ‌محورها:
  MBTI: handleMBTI,
  NEO_FFI: handleNEO,
  NEOFFI: handleNEO,
  BFI: handleBFI,
  RIASEC: handleRIASEC,
  Attachment: handleAttachment,
  ATTACHMENT: handleAttachment,

  // برای بقیه تست‌ها اگر خواستی می‌تونی بعداً به این آبجکت اضافه کنی
};

/**
 * Fallback جنرال برای تست‌هایی که هندلر اختصاصی ندارند
 */
export const fallbackInterpretation: TestInterpretationHandler = (r) => {
  const level = r.totalLevelLabel;
  if (!level) {
    return [
      chunk(
        `${r.testId}_fallback`,
        "این تست تصویری کلی از یک بُعد خاص در تو ارائه می‌دهد. " +
          "در نسخه‌ی بعدی تستولوژی، تفسیر اختصاصی این تست هم اضافه خواهد شد.",
        r.title
      ),
    ];
  }

  return [
    chunk(
      `${r.testId}_fallback_level`,
      `در این تست، نمره‌ی کلی تو در سطح «${level}» قرار گرفته است. ` +
        "این یعنی در این حوزه، وضعیتت نه در پایین‌ترین و نه در بالاترین حالت ممکن است و برای تحلیل دقیق‌تر می‌توانی به تست‌های تکمیلی مراجعه کنی.",
      r.title
    ),
  ];
};

